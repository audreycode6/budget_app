# BudgeTing
Python/Flask project using Postgresql DB

Users can create and edit budgets for different durations (monthly/annually).
Budgets track gross income and take home after deductions, bills, and summarize total saving goals and/or debt totals. Non users can demo creating a budget but won't have the ability to save their budget(s) unless signed in.

# Local Development

### poetry
 - [poetry](https://python-poetry.org/docs/) to set up
    - poetry is a tool for dependency management and packaging in Python. It allows you to declare the libraries your project depends on and it will manage (install/update) them for you. Poetry offers a lockfile to ensure repeatable installs, and can build your project for distribution.
    - create new project: `poetry new project_name`

### PostgreSQL Setup (macOS + Homebrew):
1. Make sure you have [PostgreSQL](https://www.postgresql.org/) installed.
2. Start PostgreSQL service: `brew services start postgresql@14` *replace postgresql@14 with your own version*
3. At initial setup, create the database: `createdb budget_db`

## How to run migrations
### Description:
Migrations are version control for your database schema (tables, columns, constraints).
They don’t store data — just structure.
[Flask-Migrate](https://flask-migrate.readthedocs.io/en/latest/) (which uses [Alembic](https://alembic.sqlalchemy.org/en/latest/tutorial.html) under the hood) tracks these schema changes in two places:
 - A migrations/ folder (contains version scripts like e04d030e6d84_.py)
 - A alembic_version table inside your database (keeps track of the latest applied migration)

### Migrations Usage:
1. **Make sure postgresql is running**: `brew services list`, will show the status as *started* if running.
2. **Verify your database exists**: `psql -U <username> -l`, *enter your own postgresql username in place of `<username>`*
3. Intialize migrations folder, creates the migrations/ folder (only run once at setup): `PYTHONPATH=./src poetry run flask --app budget_app.app db init`
4. **Model definitions**: `models.py` (*i.e however your app organizes SQLAlchemy models*) holds the schema for the table structures, (user, budget, budget_item), to add to the db. Changes to these models require generating a new migration.
5. **Generate a new migration after model changes**: `PYTHONPATH=./src poetry run flask --app budget_app.app db migrate -m "Note about new changes"`
    - Detects model changes & generate migration scripts. Run after editing models.
6. **Apply migrations**: `PYTHONPATH=./src poetry run flask --app budget_app.app db upgrade`
    - Applies the migration scripts generated by `db migrate` to update the database schema.
7. **Rollback** (optional): `PYTHONPATH=./src poetry run flask --app budget_app.app db downgrade`
    - Reverts the most recent migration (useful for testing or undoing structural changes).
8. **View current migration history**: `PYTHONPATH=./src poetry run flask --app budget_app.app db history`
    - Lists all migrations applied and pending, in chronological order.

## How to start the server locally
- From project root run: `PYTHONPATH=./src poetry run python -m budget_app.app`

<TODO learn how to use __init__.py to
initalize app and prevent cirular imports >
Flask apps often use __init__.py to initialize the app and extensions. Proper structuring can prevent circular import issues when importing models, routes, and extensions.


## How to run tests
- From project root run: `PYTHONPATH=./src poetry run python -m tests.test_app`

## Configuration
<TODO>

### `.env` setup
- The `.env.sample` shows the sample structure for environment variables needed to ensure privacy, replace with your own `.env` file.
    - **DATABASE_URL**: 
        - The `DATABASE_URL` environment variable tells SQLAlchemy where your database lives and how to connect to it.
        - It’s used by Flask to establish a connection when the app starts, as well as by Alembic during migrations.
        - During deployment, replace this with your production database URL provided by your hosting service.
        - The format follows:
        - `DATABASE_URL=postgresql://username:pw@localhost:5432/budget_db`
            - `username` your postgres username
            - `:pw` pw for postgress or remove if no pw
            - `/budget_db` your database name
    - **SECRET_KEY**: 
        - Flask uses to keep track of state in session and display flash messages
        - The format follows:`SECRET_KEY=secret_key`, replace `secret_key` value with your own private key.
    

# Deployment Setup
<TODO>
(brief explanation of what the production environment will use)

